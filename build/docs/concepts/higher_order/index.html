<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Higher Order Operators | Bonsai-rx Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Higher Order Operators | Bonsai-rx Documentation"><meta data-react-helmet="true" name="description" content="In most cases, when building simple reactive systems, it is enough to place a source for every device or every file you are accessing, as well as a set of transforms, sinks and combinators representing all the operations you need to perform on the data."><meta data-react-helmet="true" property="og:description" content="In most cases, when building simple reactive systems, it is enough to place a source for every device or every file you are accessing, as well as a set of transforms, sinks and combinators representing all the operations you need to perform on the data."><meta data-react-helmet="true" property="og:url" content="https://spewil.github.io/bonsai-rx-docs/docs/concepts/higher_order"><link data-react-helmet="true" rel="shortcut icon" href="/bonsai-rx-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://spewil.github.io/bonsai-rx-docs/docs/concepts/higher_order"><link rel="stylesheet" href="/bonsai-rx-docs/styles.58c8076e.css">
<link rel="preload" href="/bonsai-rx-docs/styles.0df8a571.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/runtime~main.63015df1.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/main.dcbc7212.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/1.94306779.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/48.bdc3325d.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/49.9c34573e.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/f976f453.f21dd1e2.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/47.0d02cad4.js" as="script">
<link rel="preload" href="/bonsai-rx-docs/440c40d5.bdffbd66.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/bonsai-rx-docs/"><img src="/bonsai-rx-docs/img/logo.svg" alt="bonsai-rx Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/bonsai-rx-docs/img/logo.svg" alt="bonsai-rx Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">bonsai-rx docs</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/bonsai-rx-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/bonsai-rx-docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/bonsai-rx-docs/"><img src="/bonsai-rx-docs/img/logo.svg" alt="bonsai-rx Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/bonsai-rx-docs/img/logo.svg" alt="bonsai-rx Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">bonsai-rx docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/bonsai-rx-docs/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/bonsai-rx-docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/">What is Bonsai?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/getting_started/installation">Installing Bonsai</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Basic Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/editor">Workflow Editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/gallery">Bonsai Gallery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/observables">Observables</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/property_mapping">Property Mapping</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/bonsai-rx-docs/docs/concepts/higher_order">Higher Order Operators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/operators">Operators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/packages">Package Manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/bonsai-rx-docs/docs/concepts/subjects">Subjects</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Bonsai Core</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reactive</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/amb">Amb</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/combine_latest">CombineLatest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/concat">Concat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/distinct_until_changed">DistinctUntilChanged</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/merge">Merge</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/skip">Skip</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/skip_until">SkipUntil</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/take">Take</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/take_until">TakeUntil</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/time_interval">TimeInterval</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/reactive/zip">Zip</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Expressions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/core/expressions/bitwise_not">BitwiseNot</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Workflow Fundamentals</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DAQmx</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/daqmx/analog_input">AnalogInput</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/daqmx/analog_output">AnalogOutput</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/daqmx/digital_output">DigitalOutput</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Dsp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/dsp/function_generator">FunctionGenerator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/dsp/matrix_writer">MatrixWriter</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">IO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/io/csv_writer">CsvWriter</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Pylon</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/pylon/pylon_capture">PylonCapture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Spinnaker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/spinnaker/spinnaker_capture">SpinnakerCapture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Video</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/video/camera_capture">CameraCapture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/fundamentals/video/video_writer">VideoWriter</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/meta/writing_docs">Writing Documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/bonsai-rx-docs/docs/meta/creating_packages">Creating Packages</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Higher Order Operators</h1></header><div class="markdown"><p>In most cases, when building simple reactive systems, it is enough to place a source for every device or every file you are accessing, as well as a set of transforms, sinks and combinators representing all the operations you need to perform on the data.</p><p>However, sometimes you may need to build systems that deal with an unknown number of sources. For example, imagine you wanted to create a workflow to merge together many video files. If you knew beforehand how many files you will need to combine and where they are exactly located, you might use the <a href="/bonsai-rx-docs/docs/core/reactive/concat"><code>Concat</code></a> operator to design a workflow like the following:</p><p><img alt="Concatenate video files using first order operators" src="/bonsai-rx-docs/assets/images/concatfile-firstorder-2024eb0704b3e330f77518835df58f68.svg"></p><p>But what if you did not know beforehand how many video files you will need to combine, and you wanted to merge all these videos without having to manually place a source node for every file?</p><p>Suppose all you had to get started was the <code>EnumerateFiles</code> source. This operator creates an observable sequence that will emit all the file names in a folder, one after the other.</p><p><img alt="Enumerate all file names in a folder" src="/bonsai-rx-docs/assets/images/concatfile-enumeratefiles-8431e6d3dd6c1cbd2c16c20742954b14.svg"></p><p>In order to merge all the frames from these files in a single sequence you would need to create a different <code>FileCapture</code> source for every file name emitted by this sequence, and pass all these sources to the <code>Concat</code> operator to generate a single sequence of frames. In other words, you want to create a sequence of frames for every file name in the folder, and then combine all these sequences into a single video file.</p><p>Whenever an operator receives or emits a sequence of sequences, we call it a higher order operator. These operators play a particularly powerful role in the Bonsai programming language so it is useful to describe them in some detail.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="a-metaphor-for-higher-order-operators"></a>A metaphor for higher-order operators<a class="hash-link" href="#a-metaphor-for-higher-order-operators" title="Direct link to heading">#</a></h2><p>The social network metaphor introduced at the beginning of this guide can be extended to describe higher-order operators. If observable sequences are accounts in a social network, and data items are posts published by these accounts, you can describe the video concatenation example in the following steps:</p><ol><li>Create an account that sends out a post for every file name in the target folder.</li><li>Follow the account from step 1. For every file name sent out by this account, <em>create an entirely new account</em>. Each of these new accounts matches a different file name, and will emit a sequence of posts with every frame in the corresponding video file. The output from this step is the sequence of all these newly created accounts.</li><li>Create an account that follows this sequence of accounts. When the first account from the sequence is received, follow it and repost all the frames that it sends out. After it terminates naturally, i.e. the file finishes, follow the second account in the sequence and repost all the frames from that account. Repeat for all the accounts in the sequence of accounts.</li><li>Follow the account from step 3. For every post, save the frame into a file.</li></ol><p>In this metaphor, higher-order operators allow you to create accounts from posts, or combine sequences of accounts into posts. In general, any operator that receives or emits a sequence of accounts can be considered a higher-order operator.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="higher-order-operators-in-the-bonsai-visual-language"></a>Higher-order operators in the Bonsai visual language<a class="hash-link" href="#higher-order-operators-in-the-bonsai-visual-language" title="Direct link to heading">#</a></h2><p>Higher-order operators are represented and used as nodes, just like any other operator. However, some higher-order operators allow you to specify their behaviour by using node groups. This allows you to program how the created sequences behave by reusing existing sources, transforms and other nodes.</p><p>For example, the video concatenation workflow can be implemented in Bonsai as follows:</p><p><img alt="Concatenate video files using higher order operators" src="/bonsai-rx-docs/assets/images/concatfile-higherorder-67f415ad88346062a74cc06598a8ada2.png"></p><p>The behaviour of the <code>WindowWorkflow</code> operator is specified by the floating node group. Each time a new file name is emitted by the <code>EnumerateFiles</code> source, the <code>WindowWorkflow</code> operator creates a new observable sequence controlled by the operators inside the group.</p><p>The input to the node group -- represented by the <code>Source1</code> operator -- is a sequence containing the individual items received by <code>WindowWorkflow</code>. In this case, it is a sequence with a single item that returns the file name emitted by the <code>EnumerateFiles</code> source. We use an externalized property to assign this value to the <code>FileName</code> of the <code>FileCapture</code> node, so that the correct video is accessed. Finally, the output of the node group determines the type and timing of the items emitted by the created sequence.</p><p><strong>ProTip:</strong> The <code>WindowWorkflow</code> operator creates new sequences for every input notification. However, it does not automatically subscribe to them -- they are latent. No data actually flows through the operators in the node group until some other higher-order operator -- in this case <code>Concat</code> -- actually takes these sequences and subscribes to them.
{: .notice--info}</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="marble-diagrams-for-higher-order-operators"></a>Marble diagrams for higher-order operators<a class="hash-link" href="#marble-diagrams-for-higher-order-operators" title="Direct link to heading">#</a></h2><p>Marble diagrams can also be extended to describe the behaviour of higher-order operators. Emitted sequences are represented by diagonal timelines branching off the main operator timeline. The start of the branching sequence represents the time at which that sequence was emitted.</p><p>For example, the <code>WindowWorkflow</code> operator used to convert file names into sequences of video frames is described below:</p><p><img alt="Create sequences of frames from file names" src="/bonsai-rx-docs/assets/images/concatfile-window-8dd354d3971ce72042fd3378d3a55501.svg"></p><p>This marble diagram makes clear that the operator reacts to each file name notification by creating a new observable sequence. In this case, each created sequence will emit all the frames in the specified video. In general, however, this operator can produce all kinds of sequences, determined by the particular combination of operators inside the node group.</p><p>Finally, operators can combine sequences of sequences into a single sequence by collecting all the items from each sequence. There are multiple ways to perform this combination. For example, the <code>Concat</code> operator subscribes to each emitted sequence one at a time, advancing to the next sequence only when the previous one terminated successfully.</p><p>This behaviour is described by the following marble diagram:</p><p><img alt="Combine all sequences of frames into a single sequence" src="/bonsai-rx-docs/assets/images/concatfile-combine-cde0227b72129305a356069342be1c9c.svg"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/spewil/bonsai-rx-docs/edit/master/website/docs/concepts/higher-order.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/bonsai-rx-docs/docs/concepts/property_mapping"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Property Mapping</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/bonsai-rx-docs/docs/concepts/operators"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Operators Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-metaphor-for-higher-order-operators" class="table-of-contents__link">A metaphor for higher-order operators</a></li><li><a href="#higher-order-operators-in-the-bonsai-visual-language" class="table-of-contents__link">Higher-order operators in the Bonsai visual language</a></li><li><a href="#marble-diagrams-for-higher-order-operators" class="table-of-contents__link">Marble diagrams for higher-order operators</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/bonsai-rx-docs/docs/">Home</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/bonsai-rx-docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/spewil/bonsai-rx-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Built with Docusaurus. (2020)</div></div></div></footer></div>
<script src="/bonsai-rx-docs/styles.0df8a571.js"></script>
<script src="/bonsai-rx-docs/runtime~main.63015df1.js"></script>
<script src="/bonsai-rx-docs/main.dcbc7212.js"></script>
<script src="/bonsai-rx-docs/1.94306779.js"></script>
<script src="/bonsai-rx-docs/48.bdc3325d.js"></script>
<script src="/bonsai-rx-docs/49.9c34573e.js"></script>
<script src="/bonsai-rx-docs/f976f453.f21dd1e2.js"></script>
<script src="/bonsai-rx-docs/47.0d02cad4.js"></script>
<script src="/bonsai-rx-docs/440c40d5.bdffbd66.js"></script>
</body>
</html>